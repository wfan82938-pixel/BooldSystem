<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>ä¾›è€…åˆ—è¡¨ - åŸºå› åº“ç®¡ç†ç³»ç»Ÿ</title>
    <link th:href="@{/css/bootstrap.min.css}" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <style>
        :root{ --bg:#f5f7fb; --card:#ffffff; --line:#eef1f5; --text:#1f2937; --primary:#2563eb; }
        body { background-color: var(--bg); font-family: system-ui, -apple-system, sans-serif; height: 100vh; overflow: hidden; display: flex; flex-direction: column; position: relative; }

        body::after {
            content: "ç§‘ç ”è¾…åŠ© Â· ä»…ä¾›å‚è€ƒ";
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%) rotate(-30deg);
            font-size: 6rem; color: rgba(0,0,0,0.03); pointer-events: none; z-index: 0; white-space: nowrap; font-weight: 800;
        }

        .search-group { position: relative; display: flex; align-items: center; width: 300px; background: #fff; border-radius: 6px; padding: 2px; border: 1px solid #e2e8f0; }
        .search-input { border: none; background: transparent; padding: 6px 12px; width: 100%; outline: none; font-size: 0.9rem; }
        .search-btn { background: #f8fafc; color: #64748b; border: none; padding: 5px 12px; font-weight: 600; font-size: 0.85rem; border-left: 1px solid #e2e8f0; }

        .main-card { margin: 20px; background: var(--card); border-radius: 12px; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05); height: calc(100vh - 104px); border: 1px solid var(--line); display: flex; flex-direction: column; overflow: hidden; z-index: 10; }
        .table-container { flex: 1; overflow: auto; }
        .table-custom { width: 100%; border-collapse: separate; border-spacing: 0; }
        .table-custom th { position: sticky; top: 0; background: #f8fafc; color: #475569; padding: 12px 14px; font-weight: 700; font-size: 0.85rem; border-bottom: 2px solid #e2e8f0; z-index: 10; white-space: nowrap; }
        .table-custom td { padding: 12px 14px; border-bottom: 1px solid #f1f5f9; color: #334155; vertical-align: middle; font-size: 0.9rem; white-space: nowrap; }
        .table-custom tr:hover { background: #f8fafc; }

        .col-id { color: var(--primary); font-family: Consolas, monospace; font-weight: 600; text-decoration: none; }
        .col-id:hover { text-decoration: underline; }
        .col-name-cell { font-weight: 600; color: #1e293b; text-decoration: none; }
        .col-name-cell:hover { color: var(--primary); text-decoration: underline; }

        .badge-blood { display: inline-flex; align-items: center; justify-content: center; width: 28px; height: 22px; border-radius: 4px; font-weight: 700; font-size: 0.75rem; }
        .bg-A { background: #eff6ff; color: #2563eb; border: 1px solid #bfdbfe; }
        .bg-B { background: #fff7ed; color: #c2410c; border: 1px solid #fed7aa; }
        .bg-O { background: #f0fdf4; color: #15803d; border: 1px solid #bbf7d0; }
        .bg-AB { background: #fef2f2; color: #b91c1c; border: 1px solid #fecaca; }
        .bg-æœªçŸ¥ { background: #f3f4f6; color: #6b7280; border: 1px solid #e5e7eb; }

        .footer-bar { padding: 10px 20px; border-top: 1px solid var(--line); display: flex; justify-content: space-between; align-items: center; background: var(--card); }
        .hla-cell { font-family: 'Consolas', monospace; font-size: 0.85rem; color: #64748b; }
        .toolbar { padding: 12px 20px; border-bottom: 1px solid #f1f5f9; display: flex; justify-content: space-between; align-items: center; background: #fff; }

        /* ğŸ”¥ æŒ‰é’®æ ·å¼ä¼˜åŒ– */
        .btn-custom-toolbar { display: flex; align-items: center; justify-content: center; height: 34px; padding: 0 16px; font-size: 0.9rem; font-weight: 600; border-radius: 6px; }
    </style>
</head>
<body>

<div th:replace="~{fragments :: navbar('donors')}"></div>

<div class="main-card">
    <div class="toolbar">
        <div class="d-flex align-items-center gap-3">
            <h5 class="mb-0 fw-bold text-dark"><i class="bi bi-person-lines-fill text-primary me-2"></i>ä¾›è€…åˆ—è¡¨</h5>
            <span class="badge bg-light text-secondary border">å…± [[${donorPage.totalElements}]] äºº</span>
        </div>

        <div class="d-flex gap-2">
            <form action="/donors" method="get" class="me-2">
                <div class="search-group">
                    <input type="text" name="keyword" class="search-input" placeholder="æœç´¢ ID æˆ–å§“å..." th:value="${keyword}">
                    <button type="submit" class="search-btn"><i class="bi bi-search"></i></button>
                </div>
            </form>

            <!-- ğŸ”¥ ä¿®æ”¹ï¼šæŒ‰é’®æ ·å¼ -->
            <a href="/add" class="btn btn-primary btn-custom-toolbar"><i class="bi bi-plus-lg me-1"></i>æ–°å¢ä¾›è€…</a>
            <a href="/import" class="btn btn-light border text-dark btn-custom-toolbar"><i class="bi bi-upload me-1"></i>å¯¼å…¥</a>
            <form th:action="@{/reset}" method="post" class="d-inline" onsubmit="return confirm('ç¡®å®šæ¸…ç©ºæ‰€æœ‰ä¾›è€…å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')">
                <button type="submit" class="btn btn-danger btn-custom-toolbar"><i class="bi bi-trash3 me-1"></i>æ¸…ç©ºåº“</button>
            </form>
        </div>
    </div>

    <div class="table-container">
        <table class="table-custom">
            <thead>
            <tr>
                <th>ID</th> <th>å§“å</th> <th>æ€§åˆ«</th> <th>å¹´é¾„</th> <th>è¡€å‹</th>
                <th>HPA-1</th> <th>HPA-2</th> <th>HPA-3</th> <th>HPA-4</th> <th>HPA-5</th> <th>HPA-6</th> <th>HPA-10</th> <th>HPA-15</th> <th>HPA-21</th>
                <th>HLA-A</th> <th>HLA-B</th> <th>æ“ä½œ</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="d : ${donors}">
                <td><a th:href="@{'/profile/donor/' + ${d.donorId}}" class="col-id" th:text="${d.donorId}"></a></td>
                <td><a th:href="@{'/profile/donor/' + ${d.donorId}}" class="col-name-cell" th:text="${d.name}"></a></td>

                <td th:text="${d.gender}"></td>
                <td th:text="${d.age}"></td>
                <td><span class="badge-blood" th:classappend="'bg-'+${d.bloodType}" th:text="${d.bloodType}"></span></td>

                <td th:text="${d.hpa1}"></td> <td th:text="${d.hpa2}"></td> <td th:text="${d.hpa3}"></td>
                <td th:text="${d.hpa4}"></td> <td th:text="${d.hpa5}"></td> <td th:text="${d.hpa6}"></td>
                <td th:text="${d.hpa10}"></td> <td th:text="${d.hpa15}"></td> <td th:text="${d.hpa21}"></td>

                <td class="hla-cell"><span th:text="${d.hlaA1}"></span> <br> <span th:text="${d.hlaA2}"></span></td>
                <td class="hla-cell"><span th:text="${d.hlaB1}"></span> <br> <span th:text="${d.hlaB2}"></span></td>
                <td>
                    <a th:href="@{'/edit/'+${d.donorId}}" class="text-secondary btn-sm" title="ç¼–è¾‘"><i class="bi bi-pencil-square"></i></a>
                    <form th:action="@{'/delete/'+${d.donorId}}" method="post" class="d-inline" onsubmit="return confirm('ç¡®å®šåˆ é™¤ï¼Ÿ')">
                        <button type="submit" class="btn btn-link text-danger p-0 ms-2" title="åˆ é™¤"><i class="bi bi-trash"></i></button>
                    </form>
                </td>
            </tr>
            <tr th:if="${#lists.isEmpty(donors)}"><td colspan="17" class="text-center py-5 text-muted">æš‚æ— æ•°æ®</td></tr>
            </tbody>
        </table>
    </div>

    <!-- ğŸ”¥ ä¿®å¤ï¼šå¢å¼ºå‹åˆ†é¡µæ¡ -->
    <div class="footer-bar" th:if="${donorPage.totalPages > 0}">
        <div class="text-secondary small">ç¬¬ [[${donorPage.number + 1}]] / [[${donorPage.totalPages}]] é¡µ</div>

        <nav>
            <ul class="pagination pagination-sm mb-0">
                <!-- ä¸Šä¸€é¡µ -->
                <li class="page-item" th:classappend="${donorPage.first} ? 'disabled'">
                    <a class="page-link" th:href="@{/donors(page=${donorPage.number - 1}, keyword=${keyword})}">ä¸Šä¸€é¡µ</a>
                </li>

                <!-- é¡µç å¾ªç¯ -->
                <li class="page-item" th:each="i : ${#numbers.sequence(0, donorPage.totalPages - 1)}"
                    th:classappend="${i == donorPage.number} ? 'active'"
                    th:if="${i >= donorPage.number - 2 and i <= donorPage.number + 2}">
                    <a class="page-link" th:href="@{/donors(page=${i}, keyword=${keyword})}" th:text="${i + 1}">1</a>
                </li>

                <!-- ä¸‹ä¸€é¡µ -->
                <li class="page-item" th:classappend="${donorPage.last} ? 'disabled'">
                    <a class="page-link" th:href="@{/donors(page=${donorPage.number + 1}, keyword=${keyword})}">ä¸‹ä¸€é¡µ</a>
                </li>
            </ul>
        </nav>
    </div>
</div>

<script th:src="@{/js/bootstrap.bundle.min.js}"></script>
</body>
</html>